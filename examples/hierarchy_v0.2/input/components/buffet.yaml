compound_components:
  version: 0.2
  classes:
  - name: buffet
    attributes:
      technology: 40nm
      depth: 12         # depth of the corresponding memory storage
      width: 16         # width of the corresponding memory storage
      manager_depth: 12 # manager size is 0 if there is no update
      address_width: log(depth)
      fifo_request_width: address_width + width # dependency reflected as attribute order
      update_fifo_depth: 0
    subcomponents:
      - name: buffet_manager
        class: SRAM
        attributes:
          technology: technology
          depth: manager_depth
          width: 1
      - name: fill_request_fifo
        class: FIFO
        attributes:
          technology: technology
          datawidth: fifo_request_width  # fill pushes index and data
      - name: read_request_fifo
        class: FIFO
        attributes:
          techonology: technology
          datawidth: address_width # read pushes index
      - name: read_response_fifo
        class: FIFO
        attributes:
          technology: technology
          datawidth: width   # read pops data
      - name: update_request_fifo
        class: FIFO
        attributes:
          technology: technology
          datawidth: fifo_request_width  # update pushed both index and data to buffet
          depth: update_fifo_depth
    actions:
      - name: fill
        subcomponents:
          - name: fill_request_fifo
            actions:
              - name: push
              - name: pop
      - name: read
        arguments:
          address_delta: 0..1
        subcomponents:
          - name: read_request_fifo
            actions:
              - name: push
              - name: pop
          - name: read_response_fifo
            actions:
              - name: push
              - name: pop
          - name: buffet_manager
            actions:
              - name: read
                arguments:
                  address_delta: address_delta
                  data_delta: 1  # manager width is 1 bit, data variation is not important
              - name: write
                arguments:
                  address_delta: address_delta
                  data_delta: address_delta
      - name: update
        arguments:
          address_delta: 0..1
        subcomponents:
          - name: buffet_manager
            actions:
              - name: write
                arguments:
                  address_delta: address_delta
                  data_delta: 1  # manager width is 1 bit, data variation is not important
          - name: update_request_fifo
            actions:
              - name: push
              - name: pop
      - name: idle
        subcomponents:
          - name: buffet_manager
            actions:
              - name: idle
